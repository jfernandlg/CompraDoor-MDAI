# Docker Compose - Configuración de servicios containerizados
services:

  # Servicio de Base de Datos PostgreSQL
  postgres:
    image: postgres:latest
    container_name: postgres_db
    restart: always  # Reinicio automático en caso de fallo
    environment:
      POSTGRES_USER: root        # Usuario administrador de PostgreSQL
      POSTGRES_PASSWORD: password # Contraseña del usuario (⚠️ Cambiar en producción)
      POSTGRES_DB: mi_base_de_datos # Base de datos que se creará al iniciar
    ports:
      - "5432:5432" # Mapeo de puertos: HOST:CONTAINER
      # Permite conexiones externas a PostgreSQL desde tu máquina
    volumes:
      - postgres-data:/var/lib/postgresql
      # Volumen persistente para guardar datos de la BD (evita pérdida al reiniciar)

  # Interfaz Web de Administración para PostgreSQL
  pgadmin:
    image: dpage/pgadmin4:latest
    container_name: pgadmin
    restart: always
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@dominio.com    # Email para login en pgAdmin
      PGADMIN_DEFAULT_PASSWORD: admin             # Contraseña para pgAdmin
    ports:
      - "5050:80" # Acceso web: http://localhost:5050
    depends_on:
      - postgres # Espera a que PostgreSQL esté listo antes de iniciar

  # --- SERVICIO DE SPRING BOOT AÑADIDO ---
  app:
    build: .  # Construye la imagen desde el Dockerfile en el directorio actual
    container_name: compradoor
    restart: always
    ports:
      - "8080:8080" # Tu aplicación Spring estará en http://localhost:8080
    depends_on:
      - postgres # Espera a que la base de datos esté disponible
    environment:
      # Variables de entorno que sobreescriben application.properties
      DB_HOST: postgres        # Usa el nombre del servicio como host
      DB_NAME: mi_base_de_datos
      DB_USER: root
      DB_PASS: password

# Volúmenes Docker para persistencia de datos
volumes:
  postgres-data:
  # Volumen con nombre para persistir datos de PostgreSQL entre reinicios
@startuml
'https://plantuml.com/class-diagram

skinparam {
  shadowing false
  arrowColor #003366
  borderColor #003366
  classBackgroundColor #f9f9f9
  classBorderColor #003366
  classFontSize 12
  classFontStyle normal
  defaultFontSize 12
}

title "Diagrama E/R - Sistema Inmobiliario"

entity Cliente {
  * id: UUID <<generated>>
  --
  dni: String
  nombre: String
  email: String
  telefono: int
}

entity Tarjeta {
  * id: UUID <<generated>>
  --
  codigoTarjeta: String <<unique>>
  valida: boolean
  id_cliente: UUID <<FK>>
}

entity Inmueble {
  * idInmueble: UUID <<generated>>
  --
  localidad: String
  precio: Float
  direccion: String
  pathFotos: List<String>
}

entity Compra {
  * idCompra: UUID <<generated>>
  --
  fechaCompra: Date
  precioCompra: float
  inmueble_id: UUID <<FK>>
  cliente_id: UUID <<FK>>
}

entity Venta {
  * idVenta: UUID <<generated>>
  --
  fechaVenta: Date
  precioVenta: float
  idInmueble: UUID <<FK>>
  idCliente: UUID <<FK>>
}

entity Servicio {
  * idServicio: UUID <<generated>>
  --
  tipoServicio: TipoServicio
  descripcion: String
  coste: float
  fechaAplicacion: Date
  venta_id: UUID <<FK>>
}


enum TipoServicio {
  LIMPIEZA
  MANTENIMIENTO
  REPARACION
  PINTURA
  FONTANERIA
  OTROS
}

' ========== RELACIONES ==========
Cliente ||--o{ Tarjeta : "posee (1:N)\n@OneToMany"

Cliente ||--o{ Compra : "realiza (1:N)\n@OneToMany"
Compra }o--|| Cliente : "comprador\n@ManyToOne"

Cliente ||--o{ Venta : "vende (1:N)\n@OneToMany"
Venta }o--|| Cliente : "vendedor\n@ManyToOne"

Inmueble ||--o{ Compra : "tiene (1:N)\n@OneToMany"
Compra }o--|| Inmueble : "comprado\n@ManyToOne"

Inmueble ||--|| Venta : "vendido en (1:1)\n@OneToOne"

Venta ||--o{ Servicio : "incluye (1:N)\n@OneToMany"
Servicio }o--|| Venta : "aplicado a\n@ManyToOne"

note left of Cliente
  <b>UUID como clave primaria</b>
  • Identificador único global
  • Generación automática
  • Relaciones bidireccionales
end note

note right of Tarjeta
  <b>Relación con Cliente</b>
  @ManyToOne con el cliente
  Cascade ALL y orphanRemoval
  en el lado Cliente
end note

note bottom of Venta
  <b>Relación OneToOne</b>
  Con Inmueble mediante
  @OneToOne y @JoinColumn
end note

note top of Servicio
  <b>Enum TipoServicio</b>
  Almacenado como STRING
  mediante @Enumerated
end note

\
@enduml